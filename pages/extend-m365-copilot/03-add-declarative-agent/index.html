
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/copilot-camp/pages/extend-m365-copilot/03-add-declarative-agent/">
      
      
        <link rel="prev" href="../02-build-the-api/">
      
      
        <link rel="next" href="../04-enhance-api-plugin/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Lab E3 - Add a declarative agent and API plugin - Copilot Developer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/labStyles.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#35258F" data-md-color-accent="#091F2C">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-e3-add-a-declarative-agent-and-api-plugin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Copilot Developer Camp" class="md-header__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../assets/images/CopilotCamp-Tent-Clean.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Copilot Developer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab E3 - Add a declarative agent and API plugin
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Extend Path - Extend Microsoft 365 Copilot

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../custom-engine/" class="md-tabs__link">
          
  
  Build Path - Build your own agent

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Copilot Developer Camp" class="md-nav__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../assets/images/CopilotCamp-Tent-Clean.png" alt="logo">

    </a>
    Copilot Developer Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extend Path - Extend Microsoft 365 Copilot
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Extend Path - Extend Microsoft 365 Copilot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E0 - Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-declarative-copilot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E1 - First Declarative agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-build-the-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E2 - Build an API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Lab E3 - Add a declarative agent and API plugin
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Lab E3 - Add a declarative agent and API plugin
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercise-1-upload-sample-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Upload sample documents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-create-the-declarative-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: Create the declarative agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-run-and-test-the-declarative-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: Run and test the declarative agent
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-enhance-api-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E4 - Enhance the API and plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-add-adaptive-card/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E5 - Add adaptive cards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-add-authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab E6 - Add Entra ID authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EB-add-graphconnector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab EB - Add Graph Connector
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Build Path - Build your own agent
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Build Path - Build your own agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/00-prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B0 - Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/01-custom-engine-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B1 - First custom engine agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/02-rag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B2 - Index your data in Azure AI Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/03-powered-by-ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B3 - Enhance user experience
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/04-authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B4 - Add single sign on authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-engine/05-actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab B5 - Add actions to handle complex tasks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="lab-e3-add-a-declarative-agent-and-api-plugin">Lab E3 - Add a declarative agent and API plugin</h1>
<div class="floatwide">
<div class="cc-lab-toc e-path">
  <img src="/copilot-camp/assets/images/path-icons/E-path-heading.png"></img>
  <div>
    <p>Do these labs if you want to build a Declarative agent where Microsoft 365 provides the AI model and orchestration</p>
    <ul>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/00-prerequisites/">E0 - Setup</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/01-declarative-copilot/">E1 - First declarative agent</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/02-build-the-api/">E2 - Build an API</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/03-add-declarative-agent/">E3 - Add a declarative agent and API plugin</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/04-enhance-api-plugin/">E4 - Enhance the API and plugin</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/05-add-adaptive-card/">E5 - Add adaptive cards</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/06-add-authentication/">E6 - Add Entra ID authentication</a></li>
      <li><a href="/copilot-camp/pages/extend-m365-copilot/EB-add-graphconnector/">Bonus - Add Graph Connector</a></li>
    </ul>
  </div>
</div>

<script>
(() => {

// This script decorates the table of contents with a "you are here" indicator.
const toc = document.getElementsByClassName('cc-lab-toc');
for (const div of toc) {
    const lis = div.querySelectorAll('li');
    for (const li of lis) {
        const anchor = li.querySelector('a');
        if (location.href.includes(anchor.href)) {
            const span = document.createElement("span");
            span.innerHTML = "YOU&nbsp;ARE&nbsp;HERE";
            li.appendChild(span);
        }
    }    
}
})();
</script>



  <div class="cc-e-lab-steps">
    <h4>Table of Contents</h4>
    <cc-table-of-contents />
  </div>
</div>

<p>In this lab you will add a declarative agent which is grounded in the API plugin you created in the previous lab, as well as in specific SharePoint files</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This lab builds on the previous one, Lab E2. You should be able to continue working in the same folder for labs E2-E6, but solution folders have been provided for your reference.
The finished solution for this lab is in the <a href="https://github.com/microsoft/copilot-camp/tree/main/src/extend-m365-copilot/path-e-lab03-build-declarative-agent/trey-research-lab03-END"><strong>/src/extend-m365-copilot/path-e-lab03-build-declarative-agent/trey-research-lab03-END</strong></a> folder.</p>
</div>
<h2 id="exercise-1-upload-sample-documents">Exercise 1: Upload sample documents</h2>
<p>In this step you will upload sample documents which will be used by your declarative agent to respond to user prompts. These include some consulting documents such as Statements of Work, and a simple spreadsheet containing your hours as a consultant.</p>
<h3 id="step-1-create-a-sharepoint-site">Step 1: Create a SharePoint site</h3>
<p>Within the <a href="https://www.office.com/" target="_blank">Microsoft 365 app</a>, or elsewhere in Microsoft 365, click the "waffle" menu 1️⃣ and select "SharePoint" 2️⃣.</p>
<p><img alt="The UI of Microsoft 365 with the waffle menu expanded and the SharePoint workload highlighted." src="../../../assets/images/extend-m365-copilot-05/upload-docs-01.png" /></p>
<p>Then click "Create Site" 1️⃣ and choose a "Team site" 2️⃣.</p>
<p><img alt="The UI to create a new SharePoint Online site, with 'Team Site' template suggested." src="../../../assets/images/extend-m365-copilot-05/upload-docs-02.png" /></p>
<p>Select the Standard team site template; you will be shown a preview of the site. Click "Use Template" to continue.</p>
<p><img alt="The UI to select the 'Standard' site template for the target site." src="../../../assets/images/extend-m365-copilot-05/upload-docs-03.png" /></p>
<p>Give your site a name such as "Trey Research legal documents" 1️⃣ and click "Next" 2️⃣.</p>
<p><img alt="The UI to provide name, description, and other details for the target site to create." src="../../../assets/images/extend-m365-copilot-05/upload-docs-05.png" /></p>
<p>Then select your privacy settings and language, and click "Create Site"</p>
<p><img alt="The UI to select the privacy settings and the language for the target site." src="../../../assets/images/extend-m365-copilot-05/upload-docs-06.png" /></p>
<p>After a few moments, you will be presented with a new SharePoint site. </p>
<p><cc-end-step lab="e3" exercise="1" step="1" /></p>
<h3 id="step-2-upload-the-sample-documents">Step 2: Upload the sample documents</h3>
<p>In the Documents web part, select "See all" to view the document library page.</p>
<p><img alt="The home page of the site with the Documents web part and the 'See all' link highlighted." src="../../../assets/images/extend-m365-copilot-05/upload-docs-07.png" /></p>
<p>Next, click the "Upload" 1️⃣ toolbar button and select "Files" 2️⃣.</p>
<p><img alt="The command bar of the document library with the 'Upload' menu expanded and the 'Files' option selected." src="../../../assets/images/extend-m365-copilot-05/upload-docs-08.png" /></p>
<p>Navigte to your working folder; you will find a directory called <strong>sampleDocs</strong> within. Highlight all the sample documents 1️⃣ and click "Open" 2️⃣.</p>
<p>Make note of the site url, which will resemble "https://&lt;your-tenant&gt;.sharepoint.com/sites/TreyResearchlegaldocuments", as you will need it in the next exercise.</p>
<p><img alt="The file system browsing dialog to select the files to upload." src="../../../assets/images/extend-m365-copilot-05/upload-docs-09.png" /></p>
<p><cc-end-step lab="e3" exercise="1" step="2" /></p>
<h2 id="exercise-2-create-the-declarative-agent">Exercise 2: Create the declarative agent</h2>
<h3 id="step-1-add-the-declarative-agent-json-to-your-project">Step 1: Add the declarative agent JSON to your project</h3>
<p>Create a new file called <strong>trey-declarative-agent.json</strong> within your <strong>appPackage</strong> folder. Copy the following JSON into this file and save it.</p>
<pre><code class="language-json">{
    &quot;$schema&quot;: &quot;https://aka.ms/json-schemas/copilot-extensions/vNext/declarative-copilot.schema.json&quot;,
    &quot;version&quot;: &quot;v1.0&quot;,
    &quot;name&quot;: &quot;Trey Genie Local&quot;,
    &quot;description&quot;: &quot;You are a handy assistant for consultants at Trey Research, a boutique consultancy specializing in software development and clinical trials. &quot;,
    &quot;instructions&quot;: &quot;You are consulting agent. Greet users professionally and introduce yourself as the Trey Genie. Offer assistance with their consulting projects and hours. Remind users of the Trey motto, 'Always be Billing!'. Your primary role is to support consultants by helping them manage their projects and hours. Using the TreyResearch action, you can: You can assist users in retrieving consultant profiles or project details for administrative purposes but do not participate in decisions related to hiring, performance evaluation, or assignments. You can assist users to find consultants data based on their names, project assignments, skills, roles, and certifications. You can assist users to retrieve project details based on the project or client name. You can assist users to charge hours to a project. You can assist users to add a consultant to a project. If a user inquires about the hours they have billed, charged, or worked on a project, rephrase the request to ask about the hours they have delivered. Additionally, you may provide general consulting advice. If there is any confusion, encourage users to consult their Managing Consultant. Avoid providing legal advice.&quot;,
    &quot;conversation_starters&quot;: [
        {
            &quot;title&quot;: &quot;Find consultants&quot;,
            &quot;text&quot;: &quot;Find consultants with TypeScript skills&quot;
        },
        {
            &quot;title&quot;: &quot;My Projects&quot;,
            &quot;text&quot;: &quot;What projects am I assigned to?&quot;
        },
        {
            &quot;title&quot;: &quot;My Hours&quot;,
            &quot;text&quot;: &quot;How many hours have I delivered on projects this month?&quot;
        }
    ],
    &quot;capabilities&quot;: [
        {
            &quot;name&quot;: &quot;OneDriveAndSharePoint&quot;,
            &quot;items_by_url&quot;: [
                {
                    &quot;url&quot;: &quot;${{SHAREPOINT_DOCS_URL}}&quot;
                }
            ]
        }
    ],
    &quot;actions&quot;: [
        {
            &quot;id&quot;: &quot;treyresearch&quot;,
            &quot;file&quot;: &quot;trey-plugin.json&quot;
        }
    ]
}
</code></pre>
<p>Notice that the file includes a name, description, and instructions for the declarative agent. Notice that as part of the instructions, Copilot is instructed to "Always remind users of the Trey motto, 'Always be Billing!'." You should see this when you prompt Copilot in the next exercise.</p>
<p><cc-end-step lab="e3" exercise="2" step="1" /></p>
<h3 id="step-2-add-the-url-of-your-sharepoint-site-to-the-declarative-agent">Step 2: Add the URL of your SharePoint site to the declarative agent</h3>
<p>Under "Capabilities" you will notice a SharePoint file container. While Microsoft 365 Copilot may reference any documents in SharePoint or OneDrive, this declarative agent will only access files in the Trey Research Legal Documents site you created in Exercise 1. </p>
<pre><code class="language-json">&quot;capabilities&quot;: [
    {
        &quot;name&quot;: &quot;OneDriveAndSharePoint&quot;,
        &quot;items_by_url&quot;: [
            {
                    &quot;url&quot;: &quot;${{SHAREPOINT_DOCS_URL}}&quot;
            }
        ]
    }
],
</code></pre>
<p>Notice that the SharePoint URL is actually an environment variable <code>SHAREPOINT_DOCS_URL</code>, so you need to add that to your <strong>.env.local</strong> file in the <strong>env</strong> folder. Add this in its own line at the end of the file, using your SharePoint URL:</p>
<pre><code class="language-text">SHAREPOINT_DOCS_URL=https://mytenant.sharepoint.com/sites/TreyResearchLegalDocuments
</code></pre>
<p><cc-end-step lab="e3" exercise="2" step="2" /></p>
<h3 id="step-3-examine-the-api-plugin-files">Step 3: Examine the API Plugin files</h3>
<p>Within the <strong>trey-declarative-agent.json</strong> file, you'll find an "actions" section, which tells the declarative agent to access the Trey Research API.</p>
<pre><code class="language-json">&quot;actions&quot;: [
    {
        &quot;id&quot;: &quot;treyresearch&quot;,
        &quot;file&quot;: &quot;trey-plugin.json&quot;
    }
]
</code></pre>
<p>In this step we'll look at <strong>trey-plugin.json</strong> and how it and another file describe the API to Copilot so it can make the REST calls.</p>
<p>These two files are used to describe your API to Copilot. They were already included in the project you downloaded in Lab 2, so you can examine them now:</p>
<ul>
<li><a href="https://github.com/microsoft/copilot-camp/blob/main/src/extend-m365-copilot/path-e-lab03-build-declarative-agent/trey-research-lab03-END/appPackage/trey-definition.json" target="_blank"><strong>appPackage/trey-definition.json</strong></a> - This is the <a href="https://swagger.io/specification/" target="_blank">OpenAPI Specifiction (OAS)</a> or "Swagger" file, which is an industry standard format for describing a REST API</li>
<li><a href="https://github.com/microsoft/copilot-camp/blob/main/src/extend-m365-copilot/path-e-lab03-build-declarative-agent/trey-research-lab03-END/appPackage/trey-plugin.json" target="_blank"><strong>appPackage/trey-plugin.json</strong></a> - This file contains all the Copilot-specific details that aren't described in the OAS file</li>
</ul>
<p>In this step, take a moment to examine these files. In the next few labs you'll get to know them better as we add more features to the solution.</p>
<p>In <strong>appPackage/trey-definition.json</strong>, you'll find the general description of the aplication. This includes the server URL; Teams Toolkit will create a <a href="https://learn.microsoft.com/azure/developer/dev-tunnels/" target="_blank">developer tunnel</a> to expose your local API on the Internet, and replace the token <code>"${{OPENAPI_SERVER_URL}}</code> with the public URL. It then goes on to describe every resource path, verb, and paremeter in the API. Notice the detailed descriptions; these are important to help Copilot understand how the API is to be used.</p>
<pre><code class="language-json">{
  &quot;openapi&quot;: &quot;3.0.1&quot;,
  &quot;info&quot;: {
      &quot;version&quot;: &quot;1.0.0&quot;,
      &quot;title&quot;: &quot;Trey Research API&quot;,
      &quot;description&quot;: &quot;API to streamline consultant assignment and project management.&quot;
  },
  &quot;servers&quot;: [
      {
          &quot;url&quot;: &quot;${{OPENAPI_SERVER_URL}}/api/&quot;,
          &quot;description&quot;: &quot;Production server&quot;
      }
  ],
  &quot;paths&quot;: {
      &quot;/consultants/&quot;: {
          &quot;get&quot;: {
              &quot;operationId&quot;: &quot;getConsultants&quot;,
              &quot;summary&quot;: &quot;Get consultants working at Trey Research based on consultant name, project name, certifications, skills, roles and hours available&quot;,
              &quot;description&quot;: &quot;Returns detailed information about consultants identified from filters like name of the consultant, name of project, certifications, skills, roles and hours available. Multiple filters can be used in combination to refine the list of consultants returned&quot;,
              &quot;parameters&quot;: [
                  {
                      &quot;name&quot;: &quot;consultantName&quot;,
                      &quot;in&quot;: &quot;query&quot;,
                      &quot;description&quot;: &quot;Name of the consultant to retrieve&quot;,
                      &quot;required&quot;: false,
                      &quot;schema&quot;: {
                          &quot;type&quot;: &quot;string&quot;
                      }
                  },
      ...
</code></pre>
<p>The <strong>appPackage/trey-plugin.json</strong> file has the Copilot-specific details. This includes breaking the API calls down into <em>functions</em> which can be called when Copilot has a particular use case. For example, all GET requests for <code>/consultants</code> look up one or more consultants with various parameter options, and they are grouped into a function <code>getConsultants</code>:</p>
<pre><code class="language-json">  &quot;functions&quot;: [
    {
      &quot;name&quot;: &quot;getConsultants&quot;,
      &quot;description&quot;: &quot;Returns detailed information about consultants identified from filters like name of the consultant, name of project, certifications, skills, roles and hours available. Multiple filters can be used in combination to refine the list of consultants returned&quot;,
      &quot;capabilities&quot;: {
        &quot;response_semantics&quot;: {
          &quot;data_path&quot;: &quot;$.results&quot;,
          &quot;properties&quot;: {
            &quot;title&quot;: &quot;$.name&quot;,
            &quot;subtitle&quot;: &quot;$.id&quot;,
            &quot;url&quot;: &quot;$.consultantPhotoUrl&quot;
          }
        }
      }
    },
</code></pre>
<p>Scrolling down you can find the runtime settings: </p>
<pre><code class="language-json">&quot;runtimes&quot;: [
  {
    &quot;type&quot;: &quot;OpenApi&quot;,
    &quot;auth&quot;: {
      &quot;type&quot;: &quot;None&quot;
    },
    &quot;spec&quot;: {
      &quot;url&quot;: &quot;trey-definition.json&quot;
    },
    &quot;run_for_functions&quot;: [
      &quot;getConsultants&quot;,
      &quot;getUserInformation&quot;,
      &quot;postBillhours&quot;
    ]
  }
],
</code></pre>
<p>They include a pointer to the <strong>trey-definition.json</strong> file, and an enumeration of the available functions.</p>
<p><cc-end-step lab="e3" exercise="2" step="4" /></p>
<h3 id="step-4-add-the-declarative-agent-to-your-app-manifest">Step 4: Add the declarative agent to your app manifest</h3>
<p>Now open the <strong>manifest.json</strong> file within the <strong>appPackage</strong> directory. Add, just before the <code>staticTabs</code> object, a new <code>copilotAgents</code> object with a <code>declarativeAgents</code> object inside as follows, so it references the declarative agent JSON file you created in the previous step.</p>
<pre><code class="language-json">  &quot;copilotAgents&quot;: {
    &quot;declarativeAgents&quot;: [
      {
        &quot;id&quot;: &quot;treygenie&quot;,
      &quot;file&quot;: &quot;trey-declarative-agent.json&quot;
      }
    ]
  }, 
</code></pre>
<p>Be sure to save your work. </p>
<p><cc-end-step lab="e3" exercise="2" step="4" /></p>
<h3 id="step-5-remove-the-dummy-feature-from-the-app-manifest">Step 5: Remove the dummy feature from the app manifest</h3>
<p>The initial solution that you ran in Lab E2 didn't have a declarative agent yet, so the manifest would not install because it had no features. So we added a "dummy" feature, which is a static tab pointing to the Copilot Camp home page. This would allow users to view the Copilot Camp web site in a tab within Teams, Outlook, and the the Microsoft 365 app (<a href="https://office.com">https://office.com</a>).</p>
<p>If you ever tried <a href="https://aka.ms/app-camp" target="_blank">Teams App Camp</a> you would know all about them. If not, don't worry about it, just delete these lines from <strong>manifest.json</strong> as they aren't needed anymore.</p>
<pre><code class="language-json">&quot;staticTabs&quot;: [
  {
    &quot;entityId&quot;: &quot;index&quot;,
    &quot;name&quot;: &quot;Copilot Camp&quot;,
    &quot;contentUrl&quot;: &quot;https://microsoft.github.io/copilot-camp/&quot;,
    &quot;websiteUrl&quot;: &quot;https://microsoft.github.io/copilot-camp/&quot;,
    &quot;scopes&quot;: [
      &quot;personal&quot;
    ]
  }
],
&quot;validDomains&quot;: [
  &quot;microsoft.github.io&quot;
],
</code></pre>
<p><cc-end-step lab="e3" exercise="2" step="5" /></p>
<h2 id="exercise-3-run-and-test-the-declarative-agent">Exercise 3: Run and test the declarative agent</h2>
<h3 id="step-1-run-the-new-project">Step 1: Run the new project</h3>
<p>If you're still in the debugger, stop it to force a complete re-deloyment.</p>
<p>Then start the debugger by clicking the arrow or pressing F5 and return to the Copilot user interface.</p>
<p><cc-end-step lab="e3" exercise="3" step="1" /></p>
<h3 id="step-2-test-the-declarative-agent">Step 2: Test the declarative agent</h3>
<p>Open the Copilot chat and the right flyout 1️⃣ to show your previous chats and declarative agents and select the Trey Genie Local copilot 2️⃣.</p>
<p><img alt="Microsoft 365 Copilot showing the Trey Genie agent in action. On the right side there is the custom declarative agent, together with other agents. In the main body of the page there are the conversation starters and the textbox to provide a prompt to the agent." src="../../../assets/images/extend-m365-copilot-05/run-declarative-copilot-01.png" /></p>
<p>Try a prompt such as "Please list my projects along with details from the Statement of Work doc". 
You should see a list of your projects from the API plugin, enhanced with details from each project's Statement of Work 1️⃣. Notice that Copilot includes the Trey Research motto 2️⃣ and references to the documents 3️⃣. Click one of the references to check out the document.</p>
<p><img alt="The output of the declarative agent with information about projects the user is working on, reference documents from the SharePoint site, and the motto 'Always be Billing!'" src="../../../assets/images/extend-m365-copilot-05/run-declarative-copilot-02.png" /></p>
<p><cc-end-step lab="e3" exercise="3" step="2" /></p>
<h3 id="step-3-learn-to-troubleshoot-your-api-plugin">Step 3: Learn to troubleshoot your API Plugin</h3>
<p>With any luck your declarative agent is working, but what if it's not? If your API is working but Copilot isn't calling it, what can you do?</p>
<p>The answer is simple, and it's called <em>developer mode</em>.</p>
<p>To enable developer mode, enter this prompt into Copilot:</p>
<pre><code class="language-text">-developer on
</code></pre>
<p>Then when you issue a prompt, Copilot will include an adaptive card at the end of its response with the words "Show plugin developer info". </p>
<p><img alt="The output of the declarative agent, when the developer mode is turned on. There is a button to show the plugin developer information." src="../../../assets/images/extend-m365-copilot-04/devmode1.png" /></p>
<p>If you expand by selecting the "Show plugin developer info" button , you will find details like enabled plugins that the agent can use, the matched functions and selected function that is used in the response sent by the agent. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This screen shot includes functions you won't add until the next lab.</p>
</div>
<p><img alt="Detailed information about the processing of the plugin request with enabled plugins, matched functions, selected function for execution, and function execution details." src="../../../assets/images/extend-m365-copilot-04/devmode2.png" /></p>
<p>If you expand the selected function, you will see the execution details of the API/function.</p>
<p><img alt="Developer mode" src="../../../assets/images/extend-m365-copilot-04/devmode3.png" /></p>
<p>Summary of developer mode info and their sections:</p>
<ul>
<li>Enabled plugins - explains which API plugins are available within your declarative agent</li>
<li>Matched functions - shows the available functions in your plugin JSON (<strong>trey-plugin.json</strong> in this case).</li>
<li>Selected functions for execution - shows which of the functions Copilot chose</li>
<li>Function execution details - shows the HTTP status code returned by the API when Copilot called it and allows to dig into the details of the HTTP request and response</li>
</ul>
<p>For more details please see the <a href="https://learn.microsoft.com/microsoft-365-copilot/extensibility/debugging-copilot-plugin" target="_blank">developer mode documentation</a></p>
<p><cc-end-step lab="e3" exercise="3" step="3" /></p>
<p><span style="font-size: large; font-weight: bold; color: #1c8fd2;">CONGRATULATIONS!</span></p>
<p>You've completed adding a declarative agent to your API plugin. You are now ready to proceed to add authentication to your API plugin. </p>
<p><img src="https://pnptelemetry.azurewebsites.net/copilot-camp/extend-m365-copilot/03-add-declarative-copilot" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/next-button.js"></script>
      
        <script src="../../../javascripts/cc-lab-step.js"></script>
      
        <script src="../../../javascripts/clipboard.js"></script>
      
    
  </body>
</html>